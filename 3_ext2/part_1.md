### Ερώτηση 1.
Τροποποιήστε κατάλληλα το αρχείο utopia.sh ώστε να προσθέσετε στην εικονική μηχανή utopia έναν επιπλέον δίσκο για την εικόνα fsdisk1.img. Ποια είναι η προσθήκη που κάνατε; Ποια συσκευή στο utopia είναι αυτή που μόλις προσθέσατε;

Για να προσθέσουμε τον δίσκο για την εικόνα dsdisk1.img προσθέσαμε επιπλέον **-drive** flags στην **exec** εντολή (αφού πρώτα έχουμε κατεβάσει το αρχείο `ext2-vdisks.tgz` και το εχουμε κάνει extract στο ίδιο directory που υπάρχει και το `utopia.sh`):

``` bash
exec $QEMU -enable-kvm -M pc -m $UTOPIA_MEMORY_MB \
    ...
    -drive file=./fsdisk1-7c2b425a6.img,format=raw,if=virtio \
    -drive file=./fsdisk2-a0173283d.img,format=raw,if=virtio \
    -drive file=./fsdisk3-982902777.img,format=raw,if=virtio \
    ...
```
Οπώς φαίνεται έχουμε προσθέσει και τους τρις δίσκους μιας και θα τους χρειαστούμε αργότερα.

Χρησιμοποιώντας, επίσης την εντολή `blkid` είδαμε ότι η συσκευή που προσθέσαμε είναι η `vdb`:
```bash
/dev/vdd: LABEL="fsdisk3.img" UUID="19032143-52ce-4917-8ec5-991c89ee421b" BLOCK_SIZE="1024" TYPE="ext2"
/dev/vdb: LABEL="fsdisk1.img" UUID="c63028e5-711b-410d-a263-e7ca2b15a8d3" BLOCK_SIZE="1024" TYPE="ext2"
/dev/vdc: LABEL="fsdisk2.img" UUID="d1266ad1-dae1-4275-8136-a29a4dfc9d1f" BLOCK_SIZE="1024" TYPE="ext2"
/dev/vda1: UUID="c3f61444-3056-4fc3-a339-9c8aea4314f7" BLOCK_SIZE="4096" TYPE="ext4" PARTUUID="8cc52ab1-01"
```

Το ίδιο μπορούμε να το επαληθεύσουμε αν χρησιμοποιήσουμε την εντολή `hexdump`:
```bash
root@utopia:~# hexdump -s 1024 -n 1024 -C /dev/vdb
00000400  18 32 00 00 00 c8 00 00  00 0a 00 00 90 c1 00 00  |.2..............|
00000410  0a 32 00 00 01 00 00 00  00 00 00 00 00 00 00 00  |.2..............|
00000420  00 20 00 00 00 20 00 00  28 07 00 00 a6 66 78 67  |. ... ..(....fxg|
00000430  2f 6a 78 67 02 00 ff ff  53 ef 01 00 01 00 00 00  |/jxg....S.......|
00000440  e4 7a 78 65 00 00 00 00  00 00 00 00 01 00 00 00  |.zxe............|
00000450  00 00 00 00 0b 00 00 00  80 00 00 00 00 00 00 00  |................|
00000460  00 00 00 00 00 00 00 00  c6 30 28 e5 71 1b 41 0d  |.........0(.q.A.|
00000470  a2 63 e7 ca 2b 15 a8 d3  66 73 64 69 73 6b 31 2e  |.c..+...fsdisk1.|
00000480  69 6d 67 00 00 00 00 00  2f 63 73 6c 61 62 2d 62  |img...../cslab-b|
00000490  75 6e 6b 65 72 00 00 00  00 00 00 00 00 00 00 00  |unker...........|
000004a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000004e0  00 00 00 00 00 00 00 00  00 00 00 00 a7 f1 37 f1  |..............7.|
000004f0  07 8d 4b b9 9b 0d e1 b1  22 bc 50 38 01 00 00 00  |..K.....".P8....|
00000500  0c 00 00 00 00 00 00 00  e4 7a 78 65 00 00 00 00  |.........zxe....|
00000510  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000560  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000570  00 00 00 00 00 00 00 00  15 00 00 00 00 00 00 00  |................|
00000580  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000640  00 00 00 00 00 00 00 00  60 06 00 00 00 00 00 00  |........`.......|
00000650  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000800
```


### Ερώτηση 2.
#### Προσέγγιση: tools
Εκτελούμε την εντολή `fdisk` στην συσκευή που αντιστοιχεί στην εικόνα fsdisk1.img και παίρνουμε το ακόλουθο αποτέλεσμα:
```bash
root@utopia:~# fdisk -l /dev/vdb
Disk /dev/vdb: 50 MiB, 52428800 bytes, 102400 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
```
Οπότε βλέπουμε ότι ο δίσκος έχει μέγεθος 50MiB (ισοδύναμα 52428800 bytes)

#### Προσέγγιση: hexedit
Εκτελόυμε την εντολή `hexdump /dev/vdb` και από το output παρατηρούμε το τελευταίο offset να είναι το 3200000 (σε hex μορφή). Άρα σε δεκαδική μορφή έχουμε 5242880010. Δηλαδή το μέγεθος του δίσκου είναι 50MiB.


### Ερώτηση 3
#### Προσέγγιση: tools
Σύμφωωνα με το [man-page](https://linux.die.net/man/8/blkid) της εντολής `blkid`: blkid can determine the type of content (e.g. filesystem, swap) a block device holds, and also attributes (tokens, NAME=value pairs) from the content metadata (e.g. LABEL or UUID fields). Συνεπώς, παρατηρούμε ότι είναι `ext2`:
```bash
root@utopia:~# blkid /dev/vdb
/dev/vdb: LABEL="fsdisk1.img" UUID="c63028e5-711b-410d-a263-e7ca2b15a8d3" BLOCK_SIZE="1024" TYPE="ext2"
```

#### Προσέγγιση: hexedit
Χρησιμοποιούμε την `hexdump` και παίρνουμε (read only the super block):
```bash
root@utopia:~# hexdump -s 1024 -n 1024 -C /dev/vdb
00000400  18 32 00 00 00 c8 00 00  00 0a 00 00 90 c1 00 00  |.2..............|
00000410  0a 32 00 00 01 00 00 00  00 00 00 00 00 00 00 00  |.2..............|
00000420  00 20 00 00 00 20 00 00  28 07 00 00 e4 7a 78 65  |. ... ..(....zxe|
00000430  e5 7a 78 65 01 00 ff ff  53 ef 01 00 01 00 00 00  |.zxe....S.......|
00000440  e4 7a 78 65 00 00 00 00  00 00 00 00 01 00 00 00  |.zxe............|
00000450  00 00 00 00 0b 00 00 00  80 00 00 00 00 00 00 00  |................|
00000460  00 00 00 00 00 00 00 00  c6 30 28 e5 71 1b 41 0d  |.........0(.q.A.|
00000470  a2 63 e7 ca 2b 15 a8 d3  66 73 64 69 73 6b 31 2e  |.c..+...fsdisk1.|
00000480  69 6d 67 00 00 00 00 00  2f 63 73 6c 61 62 2d 62  |img...../cslab-b|
00000490  75 6e 6b 65 72 00 00 00  00 00 00 00 00 00 00 00  |unker...........|
000004a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000004e0  00 00 00 00 00 00 00 00  00 00 00 00 a7 f1 37 f1  |..............7.|
000004f0  07 8d 4b b9 9b 0d e1 b1  22 bc 50 38 01 00 00 00  |..K.....".P8....|
00000500  0c 00 00 00 00 00 00 00  e4 7a 78 65 00 00 00 00  |.........zxe....|
00000510  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000560  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000570  00 00 00 00 00 00 00 00  0d 00 00 00 00 00 00 00  |................|
00000580  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000800
```
Στο **0x38** από το superblock start βλέπουμε το `53 ef` που είναι το magic number (little endian του EF53) που ανταποκρίνεται στα ext2/ext3/ext4.


### Ερώτηση 4
#### Προσέγγιση: tools
Σύμφωνα με το [man-page](https://linux.die.net/man/8/dumpe2fs) της εντολής `dumpe2fs`: _dumpe2fs prints the super block and blocks group information for the filesystem present on device._

Οπότε παίρνουμε:
```bash
root@utopia:~# dumpe2fs /dev/vdb
...
Filesystem created:       Tue Dec 12 15:23:16 2023
...
```

#### Προσέγγιση: hexedit
Στα byte 44 μέχρι 47 βλέπουμε το *Last mount time (in POSIX time)* το οποίο έιναι το `e4 7a 78 65` σε little endian. Για να βρούμε το date θα το μετατρέψουμε σε big endian, δηλαδή σε `65 78 7a e5`, μετά σε δεκαδική μορφή: `1702394597` και ύστερα χρησιμοποιούμε την εντολή date στο terminal για να πάρουμε την ακριβή ημερομινία:
```bash
root@utopia:~# date -d @1702394596
Tue Dec 12 03:23:17 PM UTC 2023
```

### Ερώτηση 5
#### Προσέγγιση: tools
Πάλι με χρήση `dumpe2fs` βλέπουμε ότι:
```bash
root@utopia:~# dumpe2fs /dev/vdb
...
Last mount time:          Tue Dec 12 15:23:16 2023
...
```

#### Προσέγγιση: hexedit
Βρίσκεται στα bytes 48-51 του hexdump δηλαδή, `e5 7a 78 65` το οποίο σε big endian και δεκαδική μορφή είναι το `1702394597`, άρα:
```bash
root@utopia:~# date -d @1702394597
Tue Dec 12 03:23:17 PM UTC 2023
```


### Ερώτηση 6
#### Προσέγγιση: tools
Πάλι με χρήση `dumpe2fs` βλέπουμε ότι:
```bash
root@utopia:~# dumpe2fs /dev/vdb
...
Last mounted on:          /cslab-bunker
...
```

#### Προσέγγιση: hexedit
Στο `hexdump` βλέπουμε ότι:
```bash
00000480  69 6d 67 00 00 00 00 00  2f 63 73 6c 61 62 2d 62  |img...../cslab-b|
00000490  75 6e 6b 65 72 00 00 00  00 00 00 00 00 00 00 00  |unker...........|
```


### Ερώτηση 7
#### Προσέγγιση: tools
Πάλι με χρήση `dumpe2fs` βλέπουμε ότι:
```bash
root@utopia:~# dumpe2fs /dev/vdb
...
Last write time:          Tue Dec 12 15:23:17 2023
...
```

#### Προσέγγιση: hexedit
Στο `hexdump` βλέπουμε ότι:
```bash
00000400  18 32 00 00 00 c8 00 00  00 0a 00 00 90 c1 00 00  |.2..............|
00000410  0a 32 00 00 01 00 00 00  00 00 00 00 00 00 00 00  |.2..............|
00000420  00 20 00 00 00 20 00 00  28 07 00 00 e4 7a 78 65  |. ... ..(....zxe|
00000430  e5 7a 78 65                                       |.zxe|
```
Το μετατρέπουμε σε big endian `65 78 7a e5` και ύστερα σε δεκαδικό `1702394597` και έχουμε:
```bash
root@utopia:~# date -d @1702394597
Tue Dec 12 03:23:17 PM UTC 2023
```


### Ερώτηση 8
Το μπλοκ (block) σε ένα σύστημα αρχείων είναι η βασική μονάδα αποθήκευσης δεδομένων που χρησιμοποιείται για την οργάνωση και τη διαχείριση του χώρου στον δίσκο. Είναι ένα συνεχόμενο τμήμα του αποθηκευτικού μέσου, με καθορισμένο μέγεθος, και αποτελεί το θεμέλιο για την αποθήκευση αρχείων και μεταδεδομένων στο σύστημα αρχείων.


### Ερώτηση 9
#### Προσέγγιση: tools
Πάλι με χρήση `dumpe2fs` βλέπουμε ότι:
```bash
root@utopia:~# dumpe2fs /dev/vdb
...
Block size:               1024
...
```

#### Προσέγγιση: hexedit
Το block size μπορούμε να το υπολογίσουμε στα bit 24-27 του `hexdump`, τα οποία μας δίνουν το `log2 (block size) - 10` (the number to shift 1,024 to the left by to obtain the block size):
```bash
root@utopia:~# hexdump -s 1024 -n 28 -C /dev/vdb
00000400  18 32 00 00 00 c8 00 00  00 0a 00 00 90 c1 00 00  |.2..............|
00000410  0a 32 00 00 01 00 00 00  00 00 00 00                |.2.........|
```
Οπότε έχουμε το `00 00 00 00`, οπότε το block size είναι το 1024.


### Ερώτηση 10
Το inode (Index Node) είναι μια δομή δεδομένων σε ένα σύστημα αρχείων που χρησιμοποιείται για να αποθηκεύει μεταδεδομένα σχετικά με ένα αρχείο ή έναν κατάλογο. Το inode δεν αποθηκεύει τα ίδια τα δεδομένα του αρχείου, αλλά περιλαμβάνει πληροφορίες όπως ταυτότητα αρχείου, μέγεθος αρχείου, τύπος αρχείου, δικαιώματα πρόσβασης, timestamps, hard links, και δείκτες στα μπλοκ δεδομένων που περιέχουν το περιεχόμενο του αρχείου.


### Ερώτηση 11
#### Προσέγγιση: tools
Με χρήση `dumpe2fs` βλέπουμε ότι:
```bash
root@utopia:~# dumpe2fs /dev/vdb
...
Inode size:               128
...
```

#### Προσέγγιση: hexedit
Το inode size βρίσκεται στα bytes 88, 89 του hexdump:
```bash
root@utopia:~# hexdump -s 1024 -n 90 -C /dev/vdb
00000400  18 32 00 00 00 c8 00 00  00 0a 00 00 90 c1 00 00  |.2..............|
00000410  0a 32 00 00 01 00 00 00  00 00 00 00 00 00 00 00  |.2..............|
00000420  00 20 00 00 00 20 00 00  28 07 00 00 e4 7a 78 65  |. ... ..(....zxe|
00000430  e5 7a 78 65 01 00 ff ff  53 ef 01 00 01 00 00 00  |.zxe....S.......|
00000440  e4 7a 78 65 00 00 00 00  00 00 00 00 01 00 00 00  |.zxe............|
00000450  00 00 00 00 0b 00 00 00  80 00                    |..........|
```
Άρα έχουμε `80 00`, δηλαδή το `00 80` το οποίο είναι το `128` σε δεκαδική μορφή.


### Ερώτηση 12
#### Προσέγγιση: tools
Με χρήση `dumpe2fs` βλέπουμε ότι:
```bash
root@utopia:~# dumpe2fs /dev/vdb
...
Free blocks:              49552
Free inodes:              12810
...
```

#### Προσέγγιση: hexedit
Ta unallocated blocks βρίσκονται στα bytes 12-15, και τα unallocated index στα 16-19:
```bash
root@utopia:~# hexdump -s 1024 -n 20 -C /dev/vdb
00000400  18 32 00 00 00 c8 00 00  00 0a 00 00 90 c1 00 00  |.2..............|
00000410  0a 32 00 00                                       |.2..|
```
Και έχουμε `0a 32 00 00` unallocated inodes, και `90 c1 00 00` unallocated blocks. Δηλαδή σε δεκαδική μορφή `12554`, και `49552` αντίστοιχα.


### Ερώτηση 13
Το superblock στο σύστημα αρχείων ext2 είναι μια κρίσιμη δομή δεδομένων που περιέχει βασικές πληροφορίες για τη διαμόρφωση και την κατάσταση του συστήματος αρχείων. Είναι ουσιαστικά ο "κεντρικός πίνακας ελέγχου" του συστήματος αρχείων και χρησιμοποιείται για τη διαχείριση και την οργάνωση των δεδομένων στον δίσκο.
Αποθηκεύει παραμέτρους όπως το μέγεθος του συστήματος αρχείων, το μέγεθος των μπλοκ, και τον αριθμό των inodes.
Επειδή το superblock είναι κρίσιμο για τη λειτουργία του συστήματος αρχείων, το ext2 κρατά αντίγραφα ασφαλείας του superblock σε διάφορα σημεία του δίσκου (backup superblocks). Αυτά τα αντίγραφα είναι χρήσιμα σε περίπτωση καταστροφής του κύριου superblock.


### Ερώτηση 14
Το κύριο superblock βρίσκεται 1 KB (1024 bytes) μετά την αρχή του διαμερίσματος. Αυτό σημαίνει ότι αν το μέγεθος του μπλοκ είναι 1 KB, το superblock ξεκινά στο μπλοκ 1. Αν το μέγεθος του μπλοκ είναι 2 KB ή 4 KB, το superblock ξεκινά στο μέσο του πρώτου μπλοκ.


### Ερώτηση 15
Η ύπαρξη εφεδρικών αντιγράφων του superblock σε ένα σύστημα αρχείων έχει κρίσιμη σημασία για την ανθεκτικότητα και την αξιοπιστία του συστήματος. Ο βασικός λόγος για αυτήν τη σχεδίαση είναι η προστασία από σφάλματα ή καταστροφές που μπορεί να προκύψουν στον δίσκο ή στο κύριο superblock. 


### Ερώτηση 16
_The first version of ext2 (revision 0) stores a copy at the start of every block group, along with backups of the group descriptor block(s). Because this can consume a considerable amount of space for large filesystems, later revisions can optionally reduce the number of backup copies by only putting backups in specific groups (this is the sparse superblock feature). The groups chosen are 0, 1 and powers of 3, 5 and 7._
#### Προσέγγιση: tools
Με χρήση `dumpe2fs` βλέπουμε ότι:
```bash
root@utopia:~# dumpe2fs /dev/vdb
...
Group 0: (Blocks 1-8192)
...
Group 1: (Blocks 8193-16384)
...
Group 2: (Blocks 16385-24576)
...
Group 3: (Blocks 24577-32768)
...
Group 4: (Blocks 32769-40960)
...
Group 5: (Blocks 40961-49152)
...
Group 6: (Blocks 49153-51199)
...
```
Οπότε τα εφεδρικά superblocks βρίσκονται στα blocks 8193 16385, 24577, 32769, 40961, 49153

#### Προσέγγιση: hexedit
Θα κοιτάξουμε στο `hexdump` εκεί που έχουμε **53 ef** magic number. Εκεί θα βρίσκονται τα superblocks:
```bash
root@utopia:~# hexdump -C /dev/vdb | grep '53 ef'
00000430  e5 7a 78 65 01 00 ff ff  53 ef 01 00 01 00 00 00  |.zxe....S.......|
00800430  e5 7a 78 65 01 00 ff ff  53 ef 00 00 01 00 00 00  |.zxe....S.......|
01000430  e5 7a 78 65 01 00 ff ff  53 ef 00 00 01 00 00 00  |.zxe....S.......|
01800430  e5 7a 78 65 01 00 ff ff  53 ef 00 00 01 00 00 00  |.zxe....S.......|
02000430  e5 7a 78 65 01 00 ff ff  53 ef 00 00 01 00 00 00  |.zxe....S.......|
02800430  e5 7a 78 65 01 00 ff ff  53 ef 00 00 01 00 00 00  |.zxe....S.......|
03000430  e5 7a 78 65 01 00 ff ff  53 ef 00 00 01 00 00 00  |.zxe....S.......|
```
